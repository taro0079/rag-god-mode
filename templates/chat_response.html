<div class="message assistant">
    <div class="message-avatar">ğŸ¤–</div>
    <div class="message-content">
        <div class="assistant-markdown">{{ answer_html | safe }}</div>
        {% if citations %}
        <div class="citations">
            <strong>ğŸ“š å‚è€ƒè³‡æ–™:</strong>
            {% for citation in citations %}
            <div class="citation">
                {% if citation.url %}
                <a href="{{ citation.url }}" target="_blank" rel="noopener noreferrer" class="citation-link">
                    <strong>{{ citation.title or "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ" }}</strong>
                </a>
                {% else %}
                <strong>{{ citation.title or "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ" }}</strong>
                {% endif %}
                {% if citation.issue_id %}
                <br><small>Issue ID: #{{ citation.issue_id }}</small>
                {% endif %}
                {% if citation.updated_on %}
                <br><small>æ›´æ–°æ—¥: {{ citation.updated_on }}</small>
                {% endif %}
                {% if citation.score %}
                <br><small>é–¢é€£åº¦: {{ "%.2f"|format(citation.score) }}</small>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        <div class="stats">
            ğŸ“Š ä½¿ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°: {{ used_docs }}
        </div>
    </div>
</div>

<script>
    // å±¥æ­´ã‚’æ›´æ–°
    const newHistory = {{ history | tojson }};
    chatHistory = newHistory;
    updateHistory();
    console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾Œã®å±¥æ­´:', chatHistory);

    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ€ä¸‹éƒ¨ã«
    const messagesContainer = document.getElementById('chat-messages');
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
</script>
